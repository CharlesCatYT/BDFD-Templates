$nomention
$ephemeral
$suppressErrors[]
$defer

$httpAddHeader[X-API-Key;API_KEY_HERE]
$httpAddHeader[Content-Type;application/json]

$try
    $httpPost[https://api.mojoauth.com/users/magiclink;{"email": "$input[email]"}]
$catch
      $onlyIf[1==2;Authentication API is currently having issues. Try again later!]
$endtry

$onlyIf[$httpResult[code]!=900;$httpResult[description]]
$onlyIf[$httpResult[code]!=1000;$httpResult[description]]
$onlyIf[$and[$httpResult[code]!=905;$httpResult[code]!=904]==true;$httpResult[message]! Contact developer if this error comes.]

$var[ID;$httpResult[state_id]]
$var[Expiry;2m]

A verification email has been sent into your provided email address. Kindly verify before this gets command expires after $var[Expiry].

$async[]
  $replyIn[$var[Expiry]]
  $httpGet[https://api.mojoauth.com/users/status?state_id=$var[ID]]
  $dm

  $if[$httpResult[authenticated]]
      $sendMessage[You have been successfully authenticated! :)]
  $else
       $sendMessage[Failed to authenticate. Reason : Timeout!]
  $endif
$endasync
